define(["filter_pycode/little-loader-lazy"],function(a){function m(a){if(void 0===Sk.builtinFiles||void 0===Sk.builtinFiles.files[a])throw"File not found: '"+a+"'";return Sk.builtinFiles.files[a]}function n(a,b){var c=document.createElement("div");return c.id=a,c.className=b,c}function o(a,b){var c=a.lineCount(),d=20,e=Math.min(c,d),f=100+5*Math.max(0,e-10),g=f;return g+=20*e+20,b.style.height=g+"px",100*(1-f/g)}function p(){g&&f&&(f.container.style.height=window.innerHeight-50+"px")}function q(a){if(j&&k&&l&&0!=a.length){var b=1;window.addEventListener&&window.addEventListener("resize",p,!0);for(var c=0,d=a.length;c<d;c++){var e=a[c],h=e.innerText.replace(/^\s+|\s+$/g,"");e.innerHTML="";var i="pyeditorpane"+b,q="pyeditormenu"+b,r="pycanvas"+b,s=r+"surf",u="pyoutput"+b,v="pyhidden"+b,w="pyedcon"+b,x="pymodal"+b,y=n("pycon"+b,"pycontainer"),z=n(w,"split"),A=n(q,"pymenu"),B=n(i,"pyeditor split split-horizontal"),C=n(x,"pymodal"),D=n(x+"c","pymodal-content"),E=n(r,"pycanvas"),F=n(u,"pyoutput");F.innerHTML="<pre id='"+v+"' style='display:none'></pre>";var G=e.appendChild(C),H=G.appendChild(D),I=document.createElement("span");I.innerHTML="&times;",I.className="pyclose",H.appendChild(I),H.appendChild(E),e.appendChild(A);var J=e.appendChild(y);J.appendChild(z).appendChild(B),J.appendChild(F);var L=window.CodeMirror(document.getElementById(i),{value:h,lineNumbers:!0,mode:"python"}),M=new Terminal;F.appendChild(M.html);var N=document.createElement("div");N.innerHTML="RUN &raquo;",N.className="btn btn-success",N.pyeditor=L,N.pyterminal=M,N.pyoutputid=v,N.pycanvasid=r,N.pycanvassurfaceid=s,N.pyhighlights=[],N.pymodal=G,N.pyclose=I,N.onclick=function(){var a=this.pyeditor,b=this.pyterminal,c=this.pyhighlights,d=a.getValue(),e=document.getElementById(v),h=(this.pycanvassurfaceid,this.pycanvasid,this.pymodal);if(a.getValue().includes(".Turtle()")&&(this.pymodal.style.display="block",this.pyclose.onclick=function(){h.style.display="none"}),e.innerHTML="",output="",b.clear(),c.length)for($i=0;$i<c.length;$i++)a.removeLineClass(c[$i],"background","CodeMirror-activeline-background");c.length=0,Sk.outputBuffer="",Sk.pre=this.pyoutputid,Sk.inputfun=function(a){return new Promise(function(c){b.input(a,function(a){c(a)})})},Sk.configure({output:function(a){Sk.outputBuffer+=a,-1!=a.indexOf("\n")&&(b.print(Sk.outputBuffer),Sk.outputBuffer=""),b.html.scrollTop=b.html.scrollHeight},read:m,inputfunTakesPrompt:!0,debugout:function(a){b.print(a)}}),(Sk.TurtleGraphics||(Sk.TurtleGraphics={})).target=this.pycanvasid,Sk.misceval.asyncToPromise(function(){return Sk.importMainWithBody("<stdin>",!1,d,!0)}).then(function(a){},function(d){let e=d.toString();if(d.traceback)for(let b=0;b<d.traceback.length;b++)e+="\n  at "+d.traceback[b].filename+" line "+d.traceback[b].lineno,c.push(a.addLineClass(d.traceback[b].lineno-1,"background","CodeMirror-activeline-background")),"colno"in d.traceback[b]&&(e+=" column "+d.traceback[b].colno);b.print(e)})},A.appendChild(N);var O=o(L,y),P={direction:"vertical",sizes:[O,100-O],minSize:[100,5],canvasid:r,container:y,editor:L,output:F,ratio:O,onDragEnd:function(){if(this.output.offsetHeight<100){var a=100-this.output.offsetHeight;this.container.offsetHeight<800&&(this.container.style.height=Math.min(this.container.offsetHeight+a,800)+"px");var b=100-100/this.container.offsetHeight*100;this.instance.setSizes([b,100-b]),this.ratio=b}}},Q=Split(["#"+w,"#"+u],P);P.instance=Q;var R=document.createElement("div");R.innerHTML="Fullscreen",R.className="btn btn-info",R.pycode=e,R.style="position: absolute; right: 0px; margin-right: 20px",R.splitOptions=P,R.ratio=O,R.onclick=function(){this.pycode.className.includes("pycode full")?(this.pycode.className=this.pycode.className.replace("pycode full","pycode"),this.splitOptions.container.style.height=this.splitOptions.originalHeight+"px",this.splitOptions.instance.setSizes([this.ratio,100-this.ratio]),document.body.style.overflow="",this.innerHTML="Fullscreen",g=!1):(this.pycode.className=this.pycode.className.replace("pycode","pycode full"),this.splitOptions.originalHeight=this.splitOptions.container.offsetHeight,this.splitOptions.container.style.height=window.innerHeight-50+"px",document.body.style.overflow="hidden",f=this.splitOptions,g=!0,this.splitOptions.instance.setSizes([this.ratio,100-this.ratio]),this.innerHTML="Normal View")},A.appendChild(R),b++}}}function r(){if(i&&!h){var a=document.getElementsByClassName("pycode");a.length>0&&(e="/filter/pycode/amd/src/",window._lload(e+"lib/skulpt/skulpt.min.js",function(b){window._lload(e+"lib/skulpt/skulpt-stdlib.js",function(b){j=!0,q(a)})}),window._lload(e+"lib/terminaljs/terminal.js",function(b){k=!0,q(a)}),window._lload(e+"lib/splitjs/split.js",function(b){l=!0,q(a)})),h=!0}}a.init();var f,b=document.getElementsByTagName("script"),c=b[b.length-1],d=c.src,e=d.substr(0,d.lastIndexOf("/")+1),g=!1,h=!1,i=!1,j=!1,k=!1,l=!1;return function(a,b){function f(){if(!d){d=!0;for(var a=0;a<c.length;a++)c[a].fn.call(window,c[a].ctx);c=[]}}function g(){"complete"===document.readyState&&f()}a=a||"docReady",b=b||window;var c=[],d=!1,e=!1;b[a]=function(a,b){if("function"!=typeof a)throw new TypeError("callback for docReady(fn) must be a function");if(d)return void setTimeout(function(){a(b)},1);c.push({fn:a,ctx:b}),"complete"===document.readyState?setTimeout(f,1):e||(document.addEventListener?(document.addEventListener("DOMContentLoaded",f,!1),window.addEventListener("load",f,!1)):(document.attachEvent("onreadystatechange",g),window.attachEvent("onload",f)),e=!0)}}("docReady",window),{init:function(a){docReady(function(){require.config({packages:[{name:"codemirror",location:"/filter/pycode/amd/src/lib/codemirror/",main:"lib/codemirror"}]}),require(["codemirror","codemirror/mode/python/python","codemirror/addon/hint/show-hint","codemirror/addon/hint/html-hint","codemirror/addon/mode/loadmode"],function(a){window.CodeMirror=a,i=!0,r()})})}}});